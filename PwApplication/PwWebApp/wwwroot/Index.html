<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>PW Application</title>
</head>
<body>
    <div class="userInfo" style="display:none;">
        <p>Вы вошли как: <span class="userName"></span></p>
        <input type="button" value="Logout" id="logOut" />
    </div>

    <div class="errors" style="color:red;display:none;">
        <p><span class="errorText"></span></p>
    </div>
    <div class="loginForm">
        <h3>Authorization</h3>
        <label>Enter email:</label><br />
        <input type="email" id="emailLogin" /> <br /><br />
        <label>Enter password:</label><br />
        <input type="password" id="passwordLogin" /><br /><br />
        <input type="submit" id="submitLogin" value="Login" />
    </div>
    <div class="registrationBtn">
        <input type="submit" id="registrationBtn" value="Registration" />
    </div>
    <div class="regForm" style="display:none;">
        <h3>Registration</h3>
        <label>Enter name:</label><br />
        <input type="text" id="userNameReg" /><br /><br />
        <label>Enter email:</label><br />
        <input type="email" id="emailReg" /><br /><br />
        <label>Enter password:</label><br />
        <input type="password" id="passwordReg" /><br /><br />
        <label>Enter password confirmation:</label><br />
        <input type="password" id="passwordConfirmReg" /><br /><br />
        <input type="submit" id="submitReg" value="Registration" />
        <input type="submit" id="canselReg" value="Cancel" />
    </div>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script>
        var tokenKey = "accessToken";
        $('#submitLogin').click(function (e) {
            e.preventDefault();
            var loginData = {
                grant_type: 'password',
                Email: $('#emailLogin').val(),
                Password: $('#passwordLogin').val()
            };
            $.ajax({
                type: 'POST',
                url: '/token',
                data: JSON.stringify(loginData),
                contentType: "application/json;charset=utf-8"
            }).success(function (data) {
                $('.userName').text(data.username);
                $('.userInfo').css('display', 'block');
                $('.loginForm').css('display', 'none');
                $('.errorText').empty();
                $('.errors').css('display', 'none');
                $('.registrationBtn').css('display', 'none');
                sessionStorage.setItem(tokenKey, data.access_token);
                console.log(data.access_token);
                }).fail(function (data) {
                    console.log(data);
                    $('.errorText').text(data.responseText);
                    $('.errors').css('display', 'block');                    
            });
        });

        $('#logOut').click(function (e) {
            e.preventDefault();
            $('.loginForm').css('display', 'block');
            $('.userInfo').css('display', 'none');
            sessionStorage.removeItem(tokenKey);            
        });

        $('#registrationBtn').click(function (e) {
            $('.loginForm').css('display', 'none');
            $('.regForm').css('display', 'block');
            $('.registrationBtn').css('display', 'none');
        });

        $('#submitReg').click(function (e) {
            e.preventDefault();
            var regData =
            {
                UserName: $('#userNameReg').val(),
                Email: $('#emailReg').val(),
                Password: $('#passwordReg').val(),
                PasswordConfirm: $('#passwordConfirmReg').val()
            };
            $.ajax({
                type: 'POST',
                url: '/registration',
                data: JSON.stringify(regData),
                contentType: "application/json;charset=utf-8"
            }).success(function (data) {
                alert(data);
                $('.regForm').css('display', 'none');
                $('.loginForm').css('display', 'block');
                $('.errorText').empty();
                $('.errors').css('display', 'none');
                }).fail(function (data) {
                    console.log(data);
                    $('.errorText').text(data.responseText);
                    $('.errors').css('display', 'block');
                });
        });

        $('#canselReg').click(function (e) {
            $('.loginForm').css('display', 'block');
            $('.regForm').css('display', 'none');
            $('.registrationBtn').css('display', 'block');
            $('.errorText').empty();
            $('.errors').css('display', 'none');
        });
    </script>
</body>
</html>